m.utilities={breakURLCache:function(b){return b+"?breakCache="+(new Date).getTime()},browser:{init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(b){for(var a=0;a<b.length;a++){var e=b[a].string,d=b[a].prop;this.versionSearchString=b[a].versionSearch||b[a].identity;if(e){if(e.indexOf(b[a].subString)!=
-1)return b[a].identity}else if(d)return b[a].identity}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);return a==-1?void 0:parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},
{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,
subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},capitalizeString:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},wait:function(b){return $.Deferred(function(a){setTimeout(a.resolve,b)})},dateFormatRelative:function(b){var b=
new Date(b*1E3),a=new Date,e="",e=(a.getTime()-b.getTime())/6E4,d=a.getHours()*60+a.getMinutes();return e=b.getYear()<a.getYear()?this.dateFormat(b,"mmm d, yyyy",false):e-d>1440?this.dateFormat(b,"mmm d",false):e-d>0?"yesterday":e<60?Math.floor(e)+" min ago":Math.floor(e/60)+" hrs ago"},cleanMemoId:function(b){return b.replace(/[:=-_@\.\/]/g,"")},dateFormat:function(){var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,
e=/[^-+\dA-Z]/g,d=function(a,b){a=String(a);for(b=b||2;a.length<b;)a="0"+a;return a};return function(c,g,j){var l,n,h;h={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",shortDateWithZero:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",fullDatePlusTime:"dddd, mmmm d - h:MM tt",fullDateAndTime:"m/d/yy h:MM:ss TT Z",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",
isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};l="Sun,Mon,Tue,Wed,Thu,Fri,Sat,Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");n="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec,January,February,March,April,May,June,July,August,September,October,November,December".split(",");arguments.length==1&&Object.prototype.toString.call(c)=="[object String]"&&!/\d/.test(c)&&(g=c,c=void 0);c=c?new Date(c):new Date;if(isNaN(c))throw SyntaxError("invalid date");g=String(h[g]||g||h["default"]);
g.slice(0,4)=="UTC:"&&(g=g.slice(4),j=true);var f=j?"getUTC":"get";h=c[f+"Date"]();var p=c[f+"Day"](),k=c[f+"Month"](),q=c[f+"FullYear"](),i=c[f+"Hours"](),r=c[f+"Minutes"](),s=c[f+"Seconds"](),f=c[f+"Milliseconds"](),o=j?0:c.getTimezoneOffset(),t={d:h,dd:d(h),ddd:l[p],dddd:l[p+7],m:k+1,mm:d(k+1),mmm:n[k],mmmm:n[k+12],yy:String(q).slice(2),yyyy:q,h:i%12||12,hh:d(i%12||12),H:i,HH:d(i),M:r,MM:d(r),s:s,ss:d(s),l:d(f,3),L:d(f>99?Math.round(f/10):f),t:i<12?"a":"p",tt:i<12?"am":"pm",T:i<12?"A":"P",TT:i<
12?"AM":"PM",Z:j?"UTC":(String(c).match(a)||[""]).pop().replace(e,""),o:(o>0?"-":"+")+d(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][h%10>3?0:(h%100-h%10!=10)*h%10]};return g.replace(b,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}(),convertURLstringsToAnchors:function(b){return b.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&~\?\/.=]+/g,function(a){return a.link(a)})},urlHash:{set:function(b){var b=$.toQueryParams(b),a=$.toQueryParams(location.hash),
e;for(e in b)a[e]=b[e];return $.toQueryString(a)},remove:function(b){var b=$.toQueryParams(b),a=$.toQueryParams(location.hash),e={},d;for(d in a)b[d]==void 0&&(e[d]=a[d]);return $.toQueryString(e)},get:function(b){return typeof b=="undefined"?$.toQueryParams(location.hash):$.toQueryParams(location.hash)[b]},go:function(b){location.hash=b.substr(0,1)=="#"?b:"#"+b;return false}}};
m.globalTemplates={dialogs:{removeLane:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Remove Lane</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">cancel</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>Are you sure you want to remove <strong>${title}</strong> from Memolane?</strong></p>\t\t<p>All settings will be lost, and any work you\'ve put into curating this lane will be permanently gone!</p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">Yes, REMOVE the lane!</a> <a href="#" class="secondaryAction float-left close">No, I don\'t want that</a></p>\t</div></div>',removeLaneContributor:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Stop Contributing?</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">cancel</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>Are you sure you wish to stop contributing to this lane: ${lane_title}</strong></p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">Remove me as a contributor from this lane</a> <a href="#" class="secondaryAction float-left close">No, I don\'t want that</a></p>\t</div></div>',
addFriend:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Friend Request Sent</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">close</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ">Cross your fingers!</h2>\t\t<p>You just sent a friend request to <strong>${first_name} ${last_name}</strong>.</p>\t\t<p><a href="#" class="btn-green float-left close">OK</a></p>\t</div></div>',acceptFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Accepted Friend Request</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">close</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ">We\'re friends!</h2>\t\t<p>You just accepted <strong>${first_name} ${last_name}\'s</strong> friend request!</p>\t\t<p>You can now see each other\'s "Friends Only" memos.</p>\t\t<p><a href="#" class="btn-green float-left close">OK</a></p>\t</div></div>',
rejectFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Rejected Friend Request</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">close</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ">It\'s not you, it\'s me</h2>\t\t<p>You just rejected <strong>${first_name} ${last_name}\'s</strong> friend request.</p>\t\t<p>At this point, you can only see each other\'s public memos.</p>\t</div></div>',
cancelFriendRequest:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Cancelled Friend Request</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">close</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<h2 class="header typeJ">It\'s not you, it\'s me</h2>\t\t<p>You just cancelled your request for <strong>${first_name} ${last_name}\'s</strong> friendship.</p>\t\t<p>At this point, you can only see each other\'s public memos.</p>\t</div></div>',
removeFriend:'<div id="" class="memolaneDialog">\t<div class="dialogTopBar">\t\t<div class="dialogTitle">Remove Friend?</div>\t\t<div class="close closeMemolaneDialog cancelAddingBtn">cancel</div>\t\t<div class="clearFloatNoHeight"></div>\t</div>\t<div class="dialogContent">\t\t<p><strong>Are you sure you want to cancel your Memolane friendship with ${first_name} ${last_name}</strong>?</p>\t\t<p>You and ${first_name} ${last_name} will lose the ability to see each other\'s "Friends Only" memos and contribute to each other\'s lanes.</p>\t\t<p><a href="#" class="btn-red float-left removeConfirm close">Yes, REMOVE the friend!</a> <a href="#" class="secondaryAction float-left close">No, I don\'t want that</a></p>\t</div></div>'}};
m.deviceIsIpad=navigator.userAgent.match(/iPad/i)!=null;m.deviceIsIphone=navigator.userAgent.match(/iPhone/i)!=null;m.deviceIsAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;m.isIE9=$.browser.version==="9.0"?true:false;m.isIE8=$.browser.version==="8.0"?true:false;m.clickOrTouchStart=Modernizr.touch?"touchstart":"click";m.clickOrTouchEnd=Modernizr.touch?"touchend":"click";m.mouseEnterOrTouchStart=Modernizr.touch?"touchstart":"mouseenter";
m.mouseLeaveOrTouchEnd=Modernizr.touch?"touchend":"mouseleave";m.mouseDownOrTouchStart=Modernizr.touch?"touchstart":"mousedown";m.mouseMoveOrTouchMove=Modernizr.touch?"touchmove":"mousemove";m.mouseUpOrTouchEnd=Modernizr.touch?"touchend":"mouseup";m.mouseOutOrTouchEnd=Modernizr.touch?"touchend":"mouseout";m.mouseOverOrTouchStart=Modernizr.touch?"touchstart":"mouseover";
m.topBar=function(b,a){return{initialize:function(){a(b).bind("resize",function(){m.topBar.runLayout()});this.runLayout()},runLayout:function(){var b=a("body"),d=a("#header"),c=a("#tb-search input");b.width()<1E3&&(d.removeClass("more1024").addClass("less1024"),c.attr("value","Search"));b.width()>=1E3&&(d.removeClass("less1024").addClass("more1024"),m.currentLane?c.attr("value","Search memos, lanes & users"):c.attr("value","Search lanes & users"))}}}(this,jQuery,this.undefined);m.topBar.initialize();
m.signup=function(b,a){return{$passwordInput:a("#password"),$usernameInput:a("#username"),$firstNameInput:a("#first-name"),$lastNameInput:a("#last-name"),$emailInput:a("#email"),$signupForm:a("#signup"),$signupSubmitBtn:a("#signup-btn"),initialize:function(){this.$usernameInput.bind("keyup",function(){a("#signup-username-txt").text(a(this).val())}).bind("blur",function(){a(this).val()===""&&a("#signup-username-txt").text("username")});this.maskInputs();a.validity.setup({outputMode:"modal"});this.$signupForm.submit(a.proxy(function(){this.loginIn();
return false},this));this.$usernameInput.bind("blur",this.validateUsername);this.$passwordInput.bind("blur",this.validatePassword);this.$emailInput.bind("blur",this.validateEmail);this.$firstNameInput.bind("blur",this.validateFirstName);this.$lastNameInput.bind("blur",this.validateLastName)},loginIn:function(){var b=this;a(".form-message-error").remove();this.$signupSubmitBtn.prop({disabled:true}).addClass("inactive").val("Sending");this.validateForm()?(a(".form-message-error").remove(),a.ajax({type:"POST",
url:"/users",data:{password:this.$passwordInput.val(),username:this.$usernameInput.val(),first_name:this.$firstNameInput.val(),last_name:this.$lastNameInput.val(),email:this.$emailInput.val()},error:function(d){var d=a.parseJSON(d.responseText),c=[],g="";jQuery.map(d.errors,function(a,b){b==="error_username"&&(a==="taken"&&c.push("That username has already been claimed, please try another<br />"),a==="required"&&c.push("Username required<br />"),a==="invalid_chars"&&c.push("Invalid characters in username<br />"),
a==="length"&&c.push("Username requires a min of 3 chars<br />"));b==="error_first_name"&&c.push("First name required<br />");b==="error_last_name"&&c.push("Last name required<br />");b==="error_pw"&&(a==="taken"&&c.push("Password taken<br />"),a==="required"&&c.push("Password required<br />"));b==="error_mail"&&(a==="taken"&&c.push("That email address is registered to another account &#151; please try an alternate account<br />"),a==="required"&&c.push("Password required<br />"))});a(".form-message-error").remove();
a.each(c,function(a,b){g+='<div class="form-message-error display-block">'+b+"</div>"});b.$signupSubmitBtn.prop({disabled:false}).removeClass("inactive").val("Signup").after(g)},success:function(){window.location.href="/signup2"}})):this.$signupSubmitBtn.prop({disabled:false}).removeClass("inactive").val("Signup")},validateForm:function(){a.validity.start();a("#first-name,#last-name").require();a("#password").require().minLength(8,"A minimum of 8 characters is required!");a("#username").require().minLength(3,
"A minimum of 3 characters is required!").match(/^[a-zA-Z0-9_]*$/,"Please use only A-z, 0-9, and underscore");a("#email").require().match("email","Please enter a valid email!");return a.validity.end().valid},validateUsername:function(){a(this).val()===""?a(".formError").remove():(a.validity.start(),a("#username").minLength(3,"A minimum of 3 characters is required!").match(/^[a-zA-Z0-9_]*$/,"Please use only A-z, 0-9, and underscore!"),a.validity.end())},validatePassword:function(){a(this).val()===
""?a(".formError").remove():(a.validity.start(),a("#password").minLength(8,"A minimum of 8 characters is required!"),a.validity.end())},validateEmail:function(){a(this).val()===""?a(".formError").remove():(a.validity.start(),a("#email").match("email","Please enter a valid email!"),a.validity.end())},validateLastName:function(){a(this).val()===""?a(".formError").remove():(a.validity.start(),a("#last-name").require(),a.validity.end())},validateFirstName:function(){a(this).val()===""?a(".formError").remove():
(a.validity.start(),a("#first-name").require(),a.validity.end())},maskInputs:function(){this.$usernameInput.keypress(function(a){a.which==32&&a.preventDefault()})}}}(this,jQuery,this.undefined);m.signup.initialize();m.currentUser?$(".user-is-logged-in").show():$(".user-is-not-logged-in").show();$.fn.lightbox_me.defaults.destroyOnClose=true;$.fn.lightbox_me.defaults.centered=true;m.utilities.browser.init();var currentBrowser=m.utilities.browser;
(currentBrowser.browser==="Firefox"&&parseInt($.browser.version,10)<6||currentBrowser.browser==="Opera"&&parseInt($.browser.version,10)<11||currentBrowser.browser==="Explorer"&&parseInt($.browser.version,10)<9)&&$('<div class="notifications badnews-notice"><div class="notice-text">Please consider updating your web browser. We built memolane for Explorer 9, Opera 11+, Chrome 12+, Firefox 6+, and Safari 5+. Currently we don\'t support phone devices.<a href="#" class="close-notice">X</a></div></div>').notify({expires:false});
(m.deviceIsIphone||Modernizr.touch&&!m.deviceIsIpad&&!m.deviceIsAndroid||m.deviceIsAndroid&&!navigator.userAgent.toLowerCase().match(/android 3/i))&&$('<div class="notifications badnews-notice"><div class="notice-text">Please consider using an ipad or android (3+) tablet device. Or a modern browser on a desktop or laptop computer. We currently don\'t build memolane for a mobile phone experience. <a href="#" class="close-notice">X</a></div></div>').notify({expires:false});$.ajaxSetup({data:{_csrf:m.csrf}});
$.ajaxPrefilter(function(b){b.type.toLowerCase()==="delete"&&(b.data+="&_method=DELETE")});
